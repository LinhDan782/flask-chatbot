# -*- coding: utf-8 -*-
"""TieuLuanChatbot.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1knLgnD9V3_MPQMAikAx3xLiqn1CAkKys
"""
from flask import Flask, request, render_template_string
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.naive_bayes import MultinomialNB

# ====== Hu·∫•n luy·ªán m√¥ h√¨nh h·ªçc m√°y ======
data = [
    ("gi·ªù l√†m vi·ªác c·ªßa b·∫°n l√† g√¨", "working_hours"),
    ("khi n√†o m·ªü c·ª≠a", "working_hours"),
    ("c√≥ l√†m vi·ªác cu·ªëi tu·∫ßn kh√¥ng", "working_hours"),
    ("b·∫°n m·ªü c·ª≠a l√∫c m·∫•y gi·ªù", "working_hours"),

    ("ch√≠nh s√°ch ho√†n ti·ªÅn th·∫ø n√†o", "refund_policy"),
    ("t√¥i mu·ªën ƒë·ªïi/tr·∫£ h√†ng", "refund_policy"),
    ("tr·∫£ h√†ng m·∫•t ph√≠ kh√¥ng", "refund_policy"),
    ("t√¥i ƒë√£ mua sai, ho√†n ti·ªÅn ƒë∆∞·ª£c kh√¥ng", "refund_policy"),

    ("t√¥i mu·ªën li√™n h·ªá", "contact"),
    ("l√†m sao ƒë·ªÉ g·ªçi cho b·∫°n", "contact"),
    ("email h·ªó tr·ª£ c·ªßa b·∫°n l√† g√¨", "contact"),
    ("s·ªë ƒëi·ªán tho·∫°i c·ªßa shop l√† g√¨", "contact"),

    ("b·∫°n c√≥ ship kh√¥ng", "shipping"),
    ("ph√≠ giao h√†ng l√† bao nhi√™u", "shipping"),
    ("ship COD kh√¥ng", "shipping"),
    ("giao h√†ng m·∫•t bao l√¢u", "shipping"),
]
texts, labels = zip(*data)
vectorizer = TfidfVectorizer()
X = vectorizer.fit_transform(texts)
clf = MultinomialNB()
clf.fit(X, labels)

# ====== C√°c ph·∫£n h·ªìi theo intent ======
intent_responses = {
    "working_hours": "‚è∞ Ch√∫ng t√¥i l√†m vi·ªác t·ª´ 8h ƒë·∫øn 17h, t·ª´ th·ª© 2 ƒë·∫øn th·ª© 6.",
    "refund_policy": "üí∏ B·∫°n c√≥ th·ªÉ ho√†n tr·∫£ trong v√≤ng 7 ng√†y k·ªÉ t·ª´ ng√†y mua.",
    "contact": "üìû B·∫°n c√≥ th·ªÉ li√™n h·ªá qua email: support@example.com ho·∫∑c g·ªçi 0123.456.789.",
    "shipping": "üöö Ch√∫ng t√¥i giao h√†ng to√†n qu·ªëc, h·ªó tr·ª£ COD v√† ph√≠ giao t·ª´ 20K tu·ª≥ khu v·ª±c."
}

app = Flask(__name__)

# Giao di·ªán HTML ƒë∆°n gi·∫£n
HTML_TEMPLATE = """
<!DOCTYPE html>
<html>
<head>
    <title>Chatbot Messenger</title>
    <style>
        body {
            font-family: "Segoe UI", sans-serif;
            background: #f0f2f5;
            display: flex;
            justify-content: center;
            padding: 40px;
        }
        .chat-box {
            width: 400px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        .messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 400px;
        }
        .message {
            padding: 10px 15px;
            border-radius: 20px;
            margin-bottom: 10px;
            max-width: 75%;
            display: inline-block;
            clear: both;
        }
        .user {
            background: #0084ff;
            color: white;
            float: right;
            text-align: right;
        }
        .bot {
            background: #e4e6eb;
            color: black;
            float: left;
            text-align: left;
        }
        form {
            display: flex;
            border-top: 1px solid #ccc;
        }
        input[name="message"] {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 0 0 0 10px;
        }
        input[type="submit"] {
            background: #0084ff;
            color: white;
            border: none;
            padding: 0 20px;
            border-radius: 0 0 10px 0;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="chat-box">
        <div class="messages">
            {% if user_message %}
                <div class="message user">{{ user_message }}</div>
            {% endif %}
            {% if response %}
                <div class="message bot">{{ response }}</div>
            {% endif %}
        </div>
        <form method="post">
            <input name="message" placeholder="Nh·∫≠p tin nh·∫Øn..." autocomplete="off" required/>
            <input type="submit" value="G·ª≠i"/>
        </form>
    </div>
</body>
</html>
"""

# T·∫°o ·ª©ng d·ª•ng Flask
@app.route("/", methods=["GET", "POST"])
def chatbot():
    response = ""
    user_message = ""
    if request.method == "POST":
      user_message = request.form["message"]
      X_input = vectorizer.transform([user_message])
      intent = clf.predict(X_input)[0]
      response = intent_responses.get(intent, "ü§ñ Xin l·ªói, t√¥i ch∆∞a hi·ªÉu c√¢u h·ªèi.")
    return render_template_string(HTML_TEMPLATE, user_message=user_message, response=response)

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)
app.run()
